name: AGS - Autonomous Growth System

on:
  schedule:
    # Run Monday, Wednesday, Friday at 2pm UTC (9am EST, 6am PST)
    # Adjust schedule: https://crontab.guru/#0_14_*_*_1,3,5
    - cron: "0 14 * * 1,3,5"
  workflow_dispatch: {} # Allow manual trigger from Actions tab or VS Code extension

jobs:
  generate-content:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout growth system
        uses: actions/checkout@v4
        with:
          path: growth-system
      
      - name: Checkout content site
        uses: actions/checkout@v4
        with:
          repository: ${{ secrets.CONTENT_REPO }}
          token: ${{ secrets.GH_TOKEN }}
          path: content-site
          fetch-depth: 0
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: growth-system/package-lock.json
      
      - name: Install dependencies
        working-directory: growth-system
        run: npm ci
      
      - name: Run AGS
        working-directory: growth-system
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          CONTENT_REPO: ${{ secrets.CONTENT_REPO }}
          CLOUD_MODE: "true"
        run: npm run ags:cloud
      
      # Note: PRs are created by the Publisher agent in the growth system
      # This step is a fallback if needed, but Publisher handles it automatically
      - name: Verify content site has changes
        working-directory: content-site
        if: always()
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            echo "New content detected in content-site"
            echo "PRs should have been created by Publisher agent"
          else
            echo "No new content to publish"
          fi

